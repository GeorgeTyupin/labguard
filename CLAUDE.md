# LabGuard

–°–∏—Å—Ç–µ–º–∞ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç –∏ –∫—É—Ä—Å–æ–≤—ã—Ö.

## –°—Ç–µ–∫

- Go 1.25
- PostgreSQL (pgx, —á–∏—Å—Ç—ã–π SQL)
- Telegram Bot (gopkg.in/telebot.v4)
- chi router
- golang-migrate –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
- yaml –∫–æ–Ω—Ñ–∏–≥–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### Dependency Injection

–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã. –ù–∏–∫–∞–∫–∏—Ö –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

```go
// –°–µ—Ä–≤–∏—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –Ω–µ –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
type UserService struct {
    repo UserRepository
}

func NewUserService(repo UserRepository) *UserService {
    return &UserService{repo: repo}
}
```

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

–°–ª–µ–¥—É–µ–º –∏–¥–∏–æ–º–∞—Ç–∏—á–Ω–æ–º—É Go-–ø–æ–¥—Ö–æ–¥—É: **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è** (consumer-side), –∞ –Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è.

```go
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ –ø–∞–∫–µ—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
// internal/bot/handlers/start.go
type RegisterAPIClient interface {
    CheckUserExists(telegramID int64) (bool, error)
    RegisterUser(telegramID int64, name, group string) (string, error)
}

func NewStartHandler(apiClient RegisterAPIClient, logger *slog.Logger) *StartHandler {
    return &StartHandler{client: apiClient, logger: logger}
}

// internal/bot/services/api/client.go
type HttpClient struct { ... }

// HttpClient —Ä–µ–∞–ª–∏–∑—É–µ—Ç RegisterAPIClient, –Ω–æ –ù–ï –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
func (c *HttpClient) CheckUserExists(telegramID int64) (bool, error) { ... }
func (c *HttpClient) RegisterUser(telegramID int64, name, group string) (string, error) { ... }
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã ‚Äî —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- –ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Äî –º–æ–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä—è–º–æ –≤ —Ç–µ—Å—Ç–∞—Ö
- –ú–µ–Ω—å—à–µ coupling –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏

**–ù–µ —Å–æ–∑–¥–∞—ë–º –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–∞–ø–∫—É `internal/interfaces/`** ‚Äî —ç—Ç–æ anti-pattern –¥–ª—è Go.

### –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
handler ‚Üí service ‚Üí repository
    ‚Üì         ‚Üì           ‚Üì
 –≤–∞–ª–∏–¥–∞—Ü–∏—è  –ª–æ–≥–∏–∫–∞      –ë–î
```

- **handler** ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥, –≤—ã–∑—ã–≤–∞–µ—Ç service
- **service** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ repository
- **repository** ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (PostgreSQL —á–µ—Ä–µ–∑ pgx/v5)

### –í–∞–ª–∏–¥–∞—Ü–∏—è

–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤—ã–Ω–æ—Å–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç `internal/bot/validators/`. –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ–∫—É–ø–∫–∏, –ø—Ä–æ–¥—É–∫—Ç—ã). –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### –†–∞–±–æ—Ç–∞ —Å –ë–î

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **pgx/v5** ‚Äî –Ω–∞—Ç–∏–≤–Ω—ã–π PostgreSQL –¥—Ä–∞–π–≤–µ—Ä —Å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
```go
import (
    "github.com/jackc/pgx/v5/pgxpool"
)

pool, err := pgxpool.New(ctx, cfg.Database.DSN)
```

**–ó–∞–ø—Ä–æ—Å—ã:**
- –ß–∏—Å—Ç—ã–π SQL —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ `$1, $2, $3`
- –ß–µ—Ä–µ–∑ `QueryRow`, `Query`, `Exec`
- Repository –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–æ–¥–µ–ª–∏ –∏–∑ `internal/server/model/`

**–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
```go
tx, _ := pool.Begin(ctx)
defer tx.Rollback(ctx)

// ... queries
tx.Commit(ctx)
```

### –ú–æ–¥–µ–ª–∏

–ö–∞–∂–¥–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–º–µ–µ—Ç —Å–≤–æ–∏ –º–æ–¥–µ–ª–∏:
- **internal/server/model/** ‚Äî –º–æ–¥–µ–ª–∏ –ë–î (User, Product, Purchase)
- **internal/bot/models/** ‚Äî –º–æ–¥–µ–ª–∏ –¥–ª—è –±–æ—Ç–∞ (Product —Å —Ñ–ª–∞–≥–æ–º purchased)
- **internal/client/** ‚Äî –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)

–ú–æ–¥–µ–ª–∏ –Ω–µ shared –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ ‚Äî –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
labguard/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ server/main.go              # –¢–æ–ª—å–∫–æ app.Run()
‚îÇ   ‚îú‚îÄ‚îÄ bot/main.go                 # –¢–æ–ª—å–∫–æ app.Run()
‚îÇ   ‚îî‚îÄ‚îÄ client/main.go
‚îÇ
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.go              # DI, —Å–±–æ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∑–∞–ø—É—Å–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler.go          # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ purchase.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ device.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ verify.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ purchase/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ purchase.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ device/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ device.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ license/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ license.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/       
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ postgres/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ postgres.go         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL (pgxpool)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ user.go             # UserRepository
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ product.go          # ProductRepository
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ purchase.go         # PurchaseRepository
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ device.go           # DeviceRepository
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.go                 # –ú–æ–¥–µ–ª–∏ –ë–î –¥–ª—è server
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ purchase.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.go              # DI, —Å–±–æ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∑–∞–ø—É—Å–∫, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.go             # –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.go            # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (/start)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ catalog.go          # –ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ (/products)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buy.go              # –ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ (/buy)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ my.go               # –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (/my)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ devices.go          # –°–±—Ä–æ—Å fingerprint (/devices)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ client.go       # –†–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏–∑ handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registration.go     # –í–∞–ª–∏–¥–∞—Ü–∏—è –§–ò–û –∏ –≥—Ä—É–ø–ø—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.go          # –í–∞–ª–∏–¥–∞—Ü–∏—è product_slug
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ purchase.go         # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –ø–æ–∫—É–ø–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.go            # –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products.go         # Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buy.go              # Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callbacks.go        # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è callback'–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ products.go         # –ú–æ–¥–µ–ª—å –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–ª—è –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ loggers/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ message.go
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ client/
‚îÇ       ‚îú‚îÄ‚îÄ app/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ app.go
‚îÇ       ‚îú‚îÄ‚îÄ config/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ config.go
‚îÇ       ‚îú‚îÄ‚îÄ fingerprint/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ fingerprint.go
‚îÇ       ‚îî‚îÄ‚îÄ api/
‚îÇ           ‚îî‚îÄ‚îÄ api.go              # HTTP –∫–ª–∏–µ–Ω—Ç –∫ server
‚îÇ
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îî‚îÄ‚îÄ cache/
‚îÇ       ‚îî‚îÄ‚îÄ cacheTTL.go             # Generic –∫–µ—à —Å TTL
‚îÇ
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îî‚îÄ‚îÄ labguard.exe                # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
‚îÇ
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îî‚îÄ‚îÄ 001_init.sql
‚îÇ
‚îú‚îÄ‚îÄ configs/
‚îÇ   ‚îú‚îÄ‚îÄ bot.yaml
‚îÇ   ‚îî‚îÄ‚îÄ server.yaml
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ go.mod
‚îî‚îÄ‚îÄ README.md
```

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

```sql
-- users
id SERIAL PRIMARY KEY
telegram_id BIGINT UNIQUE NOT NULL
token VARCHAR(64) UNIQUE NOT NULL
fingerprint VARCHAR(255)
fingerprint_updated_at TIMESTAMP

-- products
id SERIAL PRIMARY KEY
slug VARCHAR(50) UNIQUE NOT NULL
name VARCHAR(255) NOT NULL
price DECIMAL(10,2) NOT NULL
github_repo VARCHAR(255)

-- purchases
id SERIAL PRIMARY KEY
user_id INT REFERENCES users(id)
product_id INT REFERENCES products(id)
purchased_at TIMESTAMP DEFAULT NOW()
UNIQUE(user_id, product_id)
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –û–¥–∏–Ω fingerprint –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–±—Ä–æ—Å fingerprint: —Ä–∞–∑ –≤ 30 –¥–Ω–µ–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- –û–¥–Ω–∞ –ø–æ–∫—É–ø–∫–∞ = –æ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç –¥–ª—è —é–∑–µ—Ä–∞ (UNIQUE constraint)

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –î–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (exe)

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | /api/v1/verify | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏ |

**–ó–∞–ø—Ä–æ—Å:**
```json
{
    "token": "abc-123-xyz",
    "product_id": "lab1",
    "fingerprint": "fp_xxxxx"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{"valid": true}
// –∏–ª–∏
{"valid": false, "reason": "device_mismatch | not_purchased | invalid_token"}
```

### –î–ª—è –±–æ—Ç–∞

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | /api/v1/users | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (/start) |
| POST | /api/v1/purchases | –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ |
| POST | /api/v1/device/reset | –°–±—Ä–æ—Å fingerprint |
| GET | /api/v1/users/:telegram_id/purchases | –ú–æ–∏ –ø–æ–∫—É–ø–∫–∏ (–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç) |
| GET | /api/v1/products?telegram_id=123 | –í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Å —Ñ–ª–∞–≥–æ–º purchased |

**GET /api/v1/users/:telegram_id/purchases**
```json
{
    "token": "abc-123-xyz",
    "purchases": [
        {
            "product_slug": "lab1",
            "name": "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ1",
            "purchased_at": "2025-01-15T10:00:00Z"
        }
    ]
}
```

**GET /api/v1/products?telegram_id=123**
```json
{
    "products": [
        {
            "slug": "lab1",
            "name": "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ1",
            "price": 500,
            "purchased": true
        },
        {
            "slug": "lab2",
            "name": "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ2",
            "price": 500,
            "purchased": false
        }
    ]
}
```

## –°–µ—Ä–≤–∏—Å—ã

### Bot

Telegram –±–æ—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–∫—É–ø–∫–∏. –û–±—â–∞–µ—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ HTTP API.

**–ö–æ–º–∞–Ω–¥—ã:**
- `/start` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `/products` ‚Äî —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏
- `/my` ‚Äî –º–æ–∏ –ø–æ–∫—É–ø–∫–∏ –∏ —Ç–æ–∫–µ–Ω
- `/devices` ‚Äî —Å–±—Ä–æ—Å fingerprint

**–§–ª–æ—É –ø–æ–∫—É–ø–∫–∏ (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/products`
2. –ë–æ—Ç: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–µ–∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç
4. –ë–æ—Ç: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏ –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å üõí"
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –Ω–∞–∂–∏–º–∞–µ—Ç "–ö—É–ø–∏—Ç—å üõí"
6. –ë–æ—Ç: —Å–æ–∑–¥–∞—ë—Ç purchase —á–µ—Ä–µ–∑ API (–ø–æ–∫–∞ –±–µ–∑ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã)

**–§–ª–æ—É –ø–æ–∫—É–ø–∫–∏ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç —á–µ—Ä–µ–∑ `/products`
2. –ë–æ—Ç: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∫–∞—Ä—Ç—ã
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç, –Ω–∞–∂–∏–º–∞–µ—Ç "–Ø –æ–ø–ª–∞—Ç–∏–ª"
4. –ë–æ—Ç: —Å–æ–∑–¥–∞—ë—Ç –∑–∞—è–≤–∫—É, —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∞–¥–º–∏–Ω–∞
5. –ê–¥–º–∏–Ω: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–ø–ª–∞—Ç—É, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤ –±–æ—Ç–µ
6. –ë–æ—Ç: —Å–æ–∑–¥–∞—ë—Ç purchase —á–µ—Ä–µ–∑ API, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `labguard.exe` + `labguard.key`
7. –î–æ—Å—Ç—É–ø –∫ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é: –≤—ã–¥–∞—ë—Ç—Å—è –≤—Ä—É—á–Ω—É—é

### Server

REST API —Å–µ—Ä–≤–µ—Ä. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –±–æ—Ç–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞.

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ–ø–∏—Å–∞–Ω—ã –≤ —Å–µ–∫—Ü–∏–∏ "API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã".

### Client

Exe-—Ñ–∞–π–ª, –ª–µ–∂–∏—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–¥—É–∫—Ç–∞.

**–§–∞–π–ª—ã:**
- `labguard.exe` ‚Äî –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
- `labguard.key` ‚Äî —Ñ–∞–π–ª —Å —Ç–æ–∫–µ–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–õ–æ–≥–∏–∫–∞:**
1. –ß–∏—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ `labguard.key`
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç fingerprint –º–∞—à–∏–Ω—ã (CPU ID, MAC, hostname)
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/v1/verify
4. Exit code: 0 = –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å, 1 = –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
# configs/bot.yaml
telegram:
  token: "BOT_TOKEN"
  admin_id: 123456789

database:
  dsn: "postgres://user:pass@localhost:5432/labguard?sslmode=disable"

server:
  url: "https://api.labguard.ru"
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ü—Ä–æ–µ–∫—Ç –ø–∏—à–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é. Claude Code –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–≤—å—é –∫–æ–¥–∞.

### Git –∫–æ–º–º–∏—Ç—ã

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è [Conventional Commits](https://www.conventionalcommits.org/ru/v1.0.0/):

- `feat:` ‚Äî –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- `fix:` ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞
- `refactor:` ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- `docs:` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- `test:` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- `chore:` ‚Äî —Ä—É—Ç–∏–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∫–æ–Ω—Ñ–∏–≥–∏)
- `style:` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏)

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
<—Ç–∏–ø>: <–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ>

- –ó–Ω–∞—á–∏–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ 1
- –ó–Ω–∞—á–∏–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ 2
- –ó–Ω–∞—á–∏–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ 3
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: –¥–æ 72 —Å–∏–º–≤–æ–ª–æ–≤, –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –¢–µ–ª–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Å–∫–æ–ª—å–∫–æ
- –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ª–∞–∫–æ–Ω–∏—á–Ω—ã–º, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π
- **–ü–µ—Ä–µ–¥ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è:** –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ `git diff` –∏–ª–∏ `git diff <commit>`, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –æ–ø–∏—Å–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –í —Ç–æ–º —á–∏—Å–ª–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã. –ê –Ω–µ —Ç–æ–ª—å–∫–æ, —Ñ–∞–π–ª—ã –≥–¥–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
- –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –∑–∞–Ω–æ—Å–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ CLAUDE.md

**–ü—Ä–∏–º–µ—Ä—ã:**
```
feat: –¥–æ–±–∞–≤–∏–ª –∫–æ–º–∞–Ω–¥—É /start –≤ –±–æ—Ç–∞

fix: –∏—Å–ø—Ä–∞–≤–∏–ª –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ UserService

refactor: –ø—Ä–æ–∫–∏–Ω—É–ª –ª–æ–≥–≥–µ—Ä —á–µ—Ä–µ–∑ DI

- –î–æ–±–∞–≤–∏–ª –ø–æ–ª–µ Logger –≤ BotApp
- –ü–µ—Ä–µ–¥–∞—é logger —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä NewBot
- –£–¥–∞–ª–∏–ª –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

docs: –æ–±–Ω–æ–≤–∏–ª CLAUDE.md —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∫–æ–º–º–∏—Ç–æ–≤
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ–≤—å—é

–ü–æ—Å–∫–æ–ª—å–∫—É –ø—Ä–æ–µ–∫—Ç –ø–∏—à–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –∏ —ç—Ç–æ MVP, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–≥—É—Ç –Ω–µ —Å–æ–±–ª—é–¥–∞—Ç—å—Å—è —Å—Ä–∞–∑—É. Claude Code –¥–æ–ª–∂–µ–Ω:

- **–ú—è–≥–∫–æ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å** –æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö CLAUDE.md, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É
- **–°–ø—Ä–∞—à–∏–≤–∞—Ç—å**, –∞ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å: "–í–∏–∂—É —á—Ç–æ –∑–¥–µ—Å—å –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∞, —Ö–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –ø–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º —Ç–∞–∫?"
- **–ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å CLAUDE.md**, –µ—Å–ª–∏ —Ä–µ—à–µ–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ: "–¢—ã —Ä–µ—à–∏–ª —Å–¥–µ–ª–∞—Ç—å X –≤–º–µ—Å—Ç–æ Y. –û–±–Ω–æ–≤–∏—Ç—å CLAUDE.md?"
- **–ù–µ —Å—á–∏—Ç–∞—Ç—å –æ—à–∏–±–∫–æ–π** –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏—è –æ—Ç –ø–ª–∞–Ω–∞ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è MVP
- **–§–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –±–∞–≥–∞—Ö**, –∞ –Ω–µ –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö

–ü—Ä–∏–º–µ—Ä—ã –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –≤ MVP:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª–æ—ë–≤ (handler ‚Üí repository –Ω–∞–ø—Ä—è–º—É—é)
- –•–∞—Ä–¥–∫–æ–¥ –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Ñ–∏–≥–∞
- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ middleware

**–ó–∞–ø—É—Å–∫:**
```bash
# –ë–î
docker-compose up -d postgres

# –ú–∏–≥—Ä–∞—Ü–∏–∏
migrate -path migrations -database "postgres://..." up

# –ë–æ—Ç
go run cmd/bot/main.go -config configs/bot.yaml

# –°–µ—Ä–≤–µ—Ä
go run cmd/server/main.go -config configs/server.yaml
```

**–°–±–æ—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞:**
```bash
GOOS=windows GOARCH=amd64 go build -o assets/labguard.exe ./cmd/client
```

**–ü–æ—Ä—è–¥–æ–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
1. Bot ‚Äî –∫–æ–º–∞–Ω–¥—ã, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ–∫—É–ø–∫–∞
2. Server ‚Äî —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã API
3. Client ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏
